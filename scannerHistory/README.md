# LiveSport.tools API v2

Краткое руководство для подключения к LiveSport.tools API через веб-сокеты.

----

## Описание системы

Система объединяет одинаковые игры с разных букмекеров, а также их турниры и команды и создаёт более общие группирующие структуры - глобальные игры, глобальные турниры и глобальные команды.

Структура объединения выглядит следующим образом:

- GlobalGame #1 - глобальная игра, объединяющая игры с разных букмекеров
    - GlobalLeague - глобальный турнир, объединяющий турниры игр с разных букмекеров
    - GlobalTeam1 - первая глобальная команда, объединяющая первые команды игр с разных букмекеров
    - GlobalTeam2 - вторая глобальная команда, объединяющая вторые команды игр с разных букмекеров
    - games
        - Game #1 - игра с одного букмекера
            - League - турнир с одного букмекера
            - Team1 - первая команда с одного букмекера
            - Team2 - вторая команда с одного букмекера
        - Game #2 - игра с другого букмекера
            - League - турнир с другого букмекера
            - Team1 - первая команда с другого букмекера
            - Team2 - вторая команда с другого букмекера
        - ...

----

### Список поддерживаемых видов спорта

| Название          | Ключ                  |
| -                 | -                     |
| Soccer            | `SOCCER`              |
| Hockey            | `HOCKEY`              |
| Tennis            | `TENNIS`              |
| Baseball          | `BASEBALL`            |
| Cricket           | `CRICKET`             |
| Basketball        | `BASKETBALL`          |
| Volleyball        | `VOLLEYBALL`          |
| Handball          | `HANDBALL`            |
| Futsal            | `FUTSAL`              |
| Table tennis      | `TABLE_TENNIS`        |
| Water polo        | `WATER_POLO`          |
| Cybersport        | `CYBERSPORT`          |
| Snooker           | `SNOOKER`             |
| American footbal  | `AMERICAN_FOOTBALL`   |

### Список поддерживаемых букмекеров

| Название  | Ключ        |
| -         | -           |
| BetMGM    | `BETMGM`    |
| Pinnacle  | `PINNACLE`  |
| Betradar  | `BETRADAR`  |
| Bet365    | `BET365`    |
| Fonbet    | `FONBET`    |
| Olimp     | `OLIMP`     |

----

## Основные объекты в системе

| Название      | Описание  |
| -             | -         |
| Game          | Это самый базовый объект. Он представляет собой игру с сайта букмекера и её данные. |
| GlobalGame    | Это объект, образованный из нескольких объектов `Game`. Он объединяет несколько одинаковых игр с разных букмекеров в одно целое под названием "глобальная игра". |

----

### Структура объекта игры (Game)
> Символом `+` помечены те поля, которые доступны только при точечной подписке на Игру и которые не доступны в случае подписки на список Игр.

```js
{
    "id": Number, // идентификатор игры
    "key": String, // ключ игры - обычно идентификатор игры с сайта букмекера
    "globalGameId": Number, // идентификатор глобальной игры
    "bookie": Object, // букмекер
    "bookie.id": Number, // идентификатор букмекера
    "bookie.key": String, // ключ букмекера
    "sport": Object, // вид спорта
    "sport.id": Number, // идентификатор вида спорта
    "sport.key": String, // ключ вида спорта
    "isLive": Boolean, // флаг, показывающий, находится ли игра в лайве
    "isFinished": Boolean, // флаг, показывающий, завершилась ли игра
+   "isPaused": Boolean, // флаг, показывающий, преостановлена ли игра
    "isRestored": false, // системный флаг
    "isUnavailable": false, // флаг, показывающий, недоступна ли игра
    "startTime": Date.toISOString?, // запланированное время начала игры по расписанию
+   "liveFrom": Date.toISOString?, // первый момент, когда игра была в лайве
+   "liveTill": Date.toISOString?, // последний момент, когда игра была в лайве
    "team1": Object, // первая команда
    "team1.id": Number, // идентификатор первой команды
    "team1.name": String, // название первой команды - оригинальное название команды с сайта букмекера
    "team2": Object, // вторая команда
    "team2.id": Number, // идентификатор второй команды
    "team2.name": String, // название второй команды - оригинальное название команды с сайта букмекера
    "league": Object, // турнир
    "league.id": Number, // идентификатор турнира
    "league.name": String, // название турнира - оригинальное название турнира с сайта букмекера
    "areDetailsRelevant": Boolean, // флаг, показывающий, актуальны ли текущие данные по игре
    "areTeamsInverted": Boolean, // флаг, показывающий, были ли команды игры инвертированы системой
+   "periodKey": String, // текущий период в игре
+   "scores": Object, // текущий счёт в игре
+   "outcomes": Object, // текущие исходы игры
+   "settlements": Object, // результаты по исходам в игре
}
```

### Структура объекта глобальной игры (GlobalGame)
> Символом `+` помечены те поля, которые доступны только при точечной подписке на глобальную игру и которые не доступны в случае подписки на список глобальных игр.

```js
{
    "id": Number, // идентификатор глобальной игры
    "sport": Object, // вид спорта
    "sport.id": Number, // идентификатор вида спорта
    "sport.key": String, // ключ вида спорта
    "bookies": Object, // список букмекеров
    "bookies.{bookieId}": Object // букмекер
    "bookies.{bookieId}.id": Number, // идентификатор букмекера
    "bookies.{bookieId}.key": String, // ключ букмекера
    "startTime": Date.toISOString?, // запланированное время начала
    "globalLeague": Object, // глобальный турнир
    "globalLeague.id": Number, // идентификатор глобального турнира
    "globalLeague.name": String, // название глобального турнира
    "globalTeam1": Object, // первая глобальная команда
    "globalTeam1.id": Number, // идентификатор первой глобальной команды
    "globalTeam1.name": String, // название первой глобальной команды
    "globalTeam2": Object, // вторая глобальная команда
    "globalTeam2.id": Number, // идентификатор второй глобальной команды
    "globalTeam2.name": String, // название второй глобальной команды
    "games": Object, // список игр со всех букмекеров
    "games.{gameId}": Object, // игра
    "games.{gameId}.id": Number, // идентификатор игры
    "games.{gameId}.key": String // идентифиактор игры в системе букмекера
    "games.{gameId}.bookie": Object // букмекер игры
    "games.{gameId}.bookie.id": Number, // идентификатор букмекера игры
    "games.{gameId}.bookie.key": String, // ключ букмекера игры
    "games.{gameId}.startTime": Date.toISOString?, // запланированное время начала игры
    "games.{gameId}.isLive": Boolean, // флаг, показывающий, находится ли игра в лайве
    "games.{gameId}.isFinished": Boolean, // флаг, показывающий, завершилась ли игра
    "games.{gameId}.isRestored": Boolean, // системный флаг
    "games.{gameId}.isUnavailable": Boolean, // флаг, показывающий, недоступна ли игра
    "gamesCount": Number, // полное количество игр в глобальной игре
    "prematchGamesCount": Number, // количество прематч игр в глобальной игре
    "liveGamesCount": Number, // количество лайв игр в глобальной игре
    "finishedGamesCount": Number, // количество завершившихся игр в глобальной игре
    "inactiveGamesCount": Number, // количество неактивных игр в глобальной игре
+   "isLive": Boolean, // флаг, показывающий, находится ли глобальная игра в лайве
+   "isFinished": Boolean, // флаг, показывающий, завершилась ли глобальная игра
+   "periodKey": String, // текущий период глобальной игры
+   "scores": Object, // текущий счёт глобальной игры
+   "outcomes": Object?, // текущие исходы глобальной игры (временно недоступно)
+   "settlements": Object, // результаты по исходам глобальной игры
}
```

### Структура объекта исходов (Outcomes)

```js
{
    "{eventKey}": Object, // контейнер события
    "{eventKey}.{periodKey}": Object, // контейнер периода
    "{eventKey}.{periodKey}.{marketKey}": Object, // контейнер маркета
    "{eventKey}.{periodKey}.{marketKey}.{outcomeKey}": Object, // объект исхода
    "{eventKey}.{periodKey}.{marketKey}.{outcomeKey}.odds": Number, // шансы исхода
    "{eventKey}.{periodKey}.{marketKey}.{outcomeKey}.isBlocked": Boolean?, // заблокирован ли исход для приема ставок
    "{eventKey}.{periodKey}.{marketKey}.{outcomeKey}.isMean": Boolean?, // является ли исход серединным
}
```

`{eventKey}` - ключ события, который может принимать значения в зависимости от вида спорта, например: `result`, `corners`, `throwIns` и другие.

`{periodKey}` - ключ периода, который может принимать значения в зависимости от вида спорта, например: `mainTime`, `half:1`, `set:3`, `set:4/game:2` и другие.

`{marketKey}` - ключ маркета, который может принимать одно из следующих значений: `wins`, `handicaps`, `totals`, `team1Totals`, `team2Totals`.

`{outcomeKey}` - ключ исхода, который зависит от маркета и может быть разным, например: `first`, `-2/second`, `5.5/over`.

#### Пример объекта исходов (Outcomes)

```js
{
    "result": {
        "mainTime": {
            "wins": {
                "first": {
                    "odds": 6.5
                },
                "draw": {
                    "odds": 6
                },
                "second": {
                    "odds": 1.25
                }
            },
            "handicaps": {
                "-2/second": {
                    "isMean": true,
                    "odds": 1.88
                },
                "2/first": {
                    "isMean": true,
                    "odds": 1.83
                }
            },
            "totals": {
                "5.5/over": {
                    "isMean": true,
                    "odds": 2.1
                },
                "5.5/under": {
                    "isMean": true,
                    "odds": 1.67
                }
            },
        }
    }
}
```

### Структура объекта счёта (Scores)

```js
{
    "{eventKey}": Object, // контейнер события
    "{eventKey}.{periodKey}": [team1Score, team2Score], // счёт периода
}
```

`{eventKey}` - ключ события, который может принимать значения в зависимости от вида спорта, например: `result`, `corners`, `throwIns` и другие.

`{periodKey}` - ключ периода, который может принимать значения в зависимости от вида спорта, например: `mainTime`, `half:1`, `set:3`, `set:4/game:2` и другие.

`team1Score` - счёт первой команды, `team2Score` - счёт второй команды.

Счёт хранится в массиве из двух чисел, например: `[1,0]`, `[3,7]` и так далее.

#### Пример объекта счёта (Scores)

```js
{
    "result": {
        "mainTime": [1,3],
        "half:1": [1,1],
        "half:2": [0,2],
    },
}
```

### Структура объекта результатов (Settlements)

```js
{
    "{eventKey}": Object, // контейнер события
    "{eventKey}.{periodKey}": Object, // контейнер периода
    "{eventKey}.{periodKey}.{marketKey}": Object, // контейнер маркета
    "{eventKey}.{periodKey}.{marketKey}.{outcomeKey}": String?, // результат
}
```

Результат хранится в строке и может принимать одно из следующих значений:

| Значение  | Описание  |
| -         | -         |
| `"PENDING"` | результат ещё не определён и находится в ожидании расчёта |
| `"WIN"` | победа |
| `"LOSE"` | пройгрыш |
| `"REFUND"` | возврат |

#### Пример объекта исходов (Settlements)

```js
{
    "result": {
        "set:2": {
            "totals": {
                "20.5/over": "WIN",
                "20.5/under": "LOSE",
                "19.5/over": "WIN",
                "19.5/under": "LOSE",
                "16.5/over": "WIN",
                "16.5/under": "LOSE",
            },
            "wins": {
                "first": null,
                "second": null
            }
        }
    }
}
```

----

## Описание протокола

Протокол взаимодействия представляет собой обмен строковыми сообщениями в JSON формате через WebSocket соединение. Каждое сообщение - это массив аргументов, передаваемых в установленном порядке. Для передачи пустого аргумента используется значение `null`. Одно или несколько значений `null` в конце массива аргументов могут быть опущены.

### Структура запроса (Request)

Каждый запрос содержит следующий набор аргументов:
```js
[requestId?, requestType, data?]
```

### Описание аргументов запроса

| Аргумент  | Обязательный? | Тип | Описание  |
| -         | -             | -   | -         |
| requestId | Нет | `Number` | Идентификатор запроса - это генерируемый клиентской стороной произвольный числовой идентификатор, который служит для получения ответа. Обычно идентификатор каждого нового запроса увеличивается на единицу. |
| requestType | Да | `String` | Тип запроса - это действие, которое вы хотите совершить.
| data | Нет | `any` | Данные, передаваемые вместе с запросом.

### Структура ответа (Response)

Каждый ответ, в свою очередь, содержит следующий набор аргументов:
```js
[requestId?, error?, responseType, data?]
```

### Описание аргументов ответа
| Аргумент  | Обязательный? | Тип | Описание  |
| -         | -             | -   | -         |
| requestId | Нет | `Number` | Идентификатор запроса, для которого получен ответ. |
| error | Нет | `Object` | Объект ошибки в случае неудачного выполнения запроса. |
| responseType | Да | `String` | Тип ответа - это действие, которое было совершено в ответ на запрос.
| data | Нет | `any` | Данные, передаваемые вместе с ответом. |

## Подключение

Для подключения к API необходимо установить следующее WebSocket соединение с сервером:

```js
const webSocket = new WebSocket('wss://api.livesport.tools/v2?clientId={CLIENT_ID}');
```

Где `{CLIENT_ID}` - это ваш идентификатор клиента.

> Вы можете создавать несколько веб-сокет соединений, а можете использовать только одно.

## Авторизация

### Параметры авторизации

```js
{
    "secretKey": String, // Секретный ключ клиента
}
```

Для авторизации необходимо отправить на сервер запрос с типом `authorize` и обязательным параметром `secretKey`.

```js
[
    1,
    "authorize",
    {
        "secretKey": "{SECRET_KEY}",
        // ...
    },
]
```
Где `{SECRET_KEY}` - это ваш секертный ключ.

В случае успешной авторизации вы получите следующий ответ:

```js
[1, null, "authorized"]
```

В случае ошибки вы можете получить ответ такого вида:

```js
[
    1,
    {
        "code": "INVALID_SECRET_KEY",
        "message": "Invalid secret key provided.",
    },
]
```

----

## Управление подписками на данные

Подписка на данные - это состояние непрерывного получения актуальных данных в режиме реального времени по интересующему списку объектов или по объектам по отдельности.

После успешной подписки вы получите в ответе слепок всех актуальных данных на момент подписки, а после в режиме реального времени будете получать только его изменения.

Изменения приходят в виде объекта, который описывает, чтобы было добавлено/обновлено или удалено.

> Для удаления данных используется строка, содержащая единственный нулевой символ `"\u0000"` (он же `"\x00"` или `"\0"`). Чтобы применить изменения к изменяемому объекту в вашей системе, можно воспользоваться функцией глубокого слияния объектов [`merge` из библиотеки `lodash`](https://lodash.com/docs/4.17.15#merge), а после рекурсивно очистить измененный объект от всех свойств, где значения будут равны нулевому символу `"\u0000"`. Вы можете воспользоваться [этим примером реализации функции для очистки объекта](../../tree/main/example-app/clean-up-deeply.js).

----

## Список игр

Список игр содержит базовую информацию об играх с букмекеров.

### Параметры подписки на список игр

Список доступных параметров:
> Все параметры являются необязательными.

| Параметр    | Тип | По-умолчанию | Описание  |
| -           | -   | -            | -         |
| filter  | `Object` | `null` | Объект для фильтрации списка игр. |
| filter.globalGameIds | `Array(Number)` | `null` | Список идентификаторов интересующих глобальных игр. Только игры в составе этих глобальных игр будут попадать в список. Если вы хотите получать игры в составе любых глобальных игр, используйте значение `null`. |
| filter.sportKeys | `Array(String)` | `null` | Список ключей интересующих видов спорта. Только игры из этих видов спорта будут попадать в список. Если вы хотите получать игры с любыми видами спорта, используйте значение `null`. |
| filter.bookieKeys | `Array(String)` | `null` | Список ключей интересующих букмекеров. Только игры с этих букмекеров будут попадать в список. Если вы хотите получать игры с любых букмекеров, используйте значение `null`. |
| filter.activeOnly | `Boolean` | `true` | Показывать ли в списке игр только активные игры. Если да, то все неактивные игры будут удаляться из списка.
| filter.hasRelevantDetails | `Boolean` | `true` | Показывать ли в списке игр только игры с актуальными данными. Если да, то игры, для которых по какой-то причине в данный момент нет актуальных данных, будут удаляться из списка.

### Создание подписки на список игр

Например, для подписки на игры с фильтрацией по глобальной игре #1245771501 достаточно выполнить запрос `gameList/subscribe`:

```js
> [
    11,
    "gameList/subscribe",
    null,
    {
        "filter": {
            "globalGameIds": [1245771501],
        },
    }
]
```

В случае успешной подписки в ответ на запрос вы получите сообщение `gameList/subscribed`, а после получите сообщение `gameList/created` со слепком списка игр:

```js
< [
    8,
    null,
    "gameList/subscribed",
]
```

```js
< [
    null,
    null,
    "gameList/created",
    {
        "1285221502": {
            "id": 1285221502,
        },
        "1285221503": {
            "id": 1285221503,
            // ...
        },
        // ...
    }
]
```

При изменении списка игр вы получите сообщение `gameList/updated` с изменениями:

```js
< [
    null,
    null,
    "gameList/updated",
    {
        "1285221503": {
            "isLive": true,
        },
        // ...
    }
]
```

При удалении глобальной игры из списка вы получите следующее сообщение:

```js
< [
    null,
    null,
    "gameList/updated",
    {
        "1285221503": "\u0000",
        // ...
    }
]
```

> В одном сообщении `gameList/updated` могут приходить множественные изменения списка игр.

### Изменение подписки на список игр

Если вы хотите поменять или расширить параметры подписки, например, чтобы добавить фильтрацию по видам спорта, вы можете выполнить запрос `gameList/resubscribe`:

```js
> [
    9,
    "gameList/resubscribe",
    null,
    {
        "filter": {
            "globalGameIds": [1245771501],
            "sportKeys:" ["SOCCER"],
        },
    }
]
```

В ответ вы получите сообщение `gameList/resubscribed`, а в последующих сообщениях `gameList/updated` будет получены изменения списка игр относительно его прошлого состояния:

```js
< [
    9,
    null,
    "gameList/resubscribed",
    {
        "1285221505": "\u0000", // игра #1285221505 была удалена
        "1285221506": {
            "id": 1285221506,
            "sport": {
                "id": 1,
                "key": "SOCCER"
            },
            // ...
        },
        // ...
    }
]
```

### Отмена подписки на список игр

Для отмены подписки на список игр достаточно выполнить запрос `gameList/unsubscribe`:

```js
> [
    10,
    "gameList.unsubscribe",
]
```

В ответ вы получите сообщение `gameList/unsubscribed`, а перед этим будет получено сообщение `gameList/deleted`, удаляющее список глобальных игр:

```js
< [
    null,
    null,
    "gameList/deleted",
    "\u0000",
]
```

```js
< [
    10,
    null,
    "gameList/unsubscribed",
]
```

----

## Игра

### Создание подписки на игру

Например, для подписки на игру #1151635659 достаточно выполнить запрос `game:1151635659/subscribe`:

```js
> [
    11,
    "game:1151635659/subscribe",
]
```

В случае успешной подписки в ответ на запрос вы получите сообщение `game:1151635659/subscribed`, а после получите сообщение `game:1151635659/created` со слепком данных игры:

```js
< [
    11,
    null,
    "game:1151635659/subscribed",
]
```

```js
[
    null,
    "game:1151635659/created",
    {
        "id": 1151635659,
        // ...
    }
]
```

При изменении данных игры вы получите сообщение `game:1151635659/updated` с изменениями:

```js
< [
    null,
    null,
    "game:1151635659/updated",
    {
        "periodKey": "set:3",
        // ...
    }
]
```

> В одном сообщении `game:1151635659/updated` могут приходить множественные изменения данных игры.

При удалении игры вы получите сообщение об удалении, а также сообщение о принудительной отписке:

```js
< [
    null,
    null,
    "game:1151635659/deleted",
    "\u0000",
]
```

```js
< [
    null,
    null,
    "game:1151635659/unsubscribed",
]
```

### Отмена подписки на игру

Для отмены подписки на игру достаточно выполнить запрос `gameList/unsubscribe`:

```js
> [
    12,
    "game:1151635659/unsubscribe",
]
```

В ответ вы получите сообщение `game:1151635659/unsubscribed`, а перед этим будет получено сообщение `game:1151635659/deleted`, удаляющее игру:

```js
< [
    null,
    null,
    "game:1151635659/deleted",
    "\u0000",
]
```

```js
< [
    12,
    null,
    "game:1151635659/unsubscribed",
]
```

----

## Список глобальных игр

Список глобальных игр содержит базовую информацию о глобальных играх.

### Параметры подписки на список глобальных игр

Список доступных параметров:
| Параметр    | Обязательный? | Тип данных | По-умолчанию | Описание  |
| -           | -             | -          | -            | -         |
| filter  | Нет | `Object` | `null` | Объект для фильтрации списка глобальных игр. |
| filter.sportKeys | Нет | `Array(String)` | `null` | Список ключей интересующих видов спорта. Только глобальные игры из этих видов спорта будут попадать в список. Если вы хотите получать глобальные игры по любым видамам спорта, используйте значение `null`. |
| filter.bookieKeys | Нет | `Array(String)` | `null` | Список ключей интересующих букмекеров. Только глобальные игры, в которых присутствуют все эти букмекеры, будут попадать в список. Если вы хотите, чтобы в список попадали глобальные игры с любыми букмекерами, используйте значение `null`. |
| filter.minBookies  | Нет | `Number` | `2` | Минимальное количество разных букмекеров в глобальных играх, чтобы глобальная игра попала в список. Может быть больше или равно `1`. |

### Создание подписки на список глобальных игр

Например, для подписки на все глобальные игры по футболу (`SOCCER`), где есть игра с букмекера `BET365`, достаточно выполнить запрос `globalGameList.subscribe`:

```js
> [
    8,
    "globalGameList/subscribe",
    {
        "filter": {
            "sportKeys": ["SOCCER"],
            "bookieKeys": ["BET365"],
        },
    }
]
```

В случае успешной подписки в ответ на запрос вы получите сообщение `globalGameList/subscribed`, а после получите сообщение `globalGameList/created` со слепком списка глобальных игр:

```js
< [
    8,
    null,
    "globalGameList/subscribed",
]
```

```js
< [
    null,
    null,
    "globalGameList/created",
    {
        "1245771501": {
            "id": 1245771501,
            // ...
        },
        // ...
    }
]
```

При изменении списка глобальных игр вы получите сообщение `globalGameList/updated` с изменениями:

```js
< [
    null,
    null,
    "globalGameList/updated",
    {
        "1245771501": {
            "liveGamesCount": 1,
            "inactiveGamesCount": 2
        },
        // ...
    }
]
```

При удалении глобальной игры из списка вы получите следующее сообщение:

```js
< [
    null,
    null,
    "globalGameList/updated",
    {
        "1245771501": "\u0000",
        // ...
    }
]
```

> В одном сообщении `globalGameList/updated` могут приходить множественные изменения списка глобальных игр.

### Изменение подписки на список глобальных игр

Если вы хотите поменять или расширить параметры подписки, например, чтобы поменять вид спорта, вы можете выполнить запрос `globalGameList/resubscribe`:

```js
> [
    9,
    "globalGameList/resubscribe",
    null,
    {
        "filter": {
            "sportKeys:" ["TENNIS"],
        },
    }
]
```

В ответ вы получите сообщение `globalGameList/resubscribed`, а в последующих сообщениях `globalGameList/updated` будет получены изменения списка глобальных игр относительно его прошлого состояния:

```js
< [
    9,
    null,
    "globalGameList/resubscribed",
    {
        "1245771502": "\u0000", // глобальная игра #1245771502 была удалена
        "1245649556": {
            "id": 1245649556,
            "sport": {
                "id": 4,
                "key": "TENNIS"
            },
            "bookies": [
                {
                    "id": 1,
                    "key": "FONBET"
                },
                {
                    "id": 2,
                    "key": "OLIMP"
                },
                {
                    "id": 3,
                    "key": "BET365"
                },
                {
                    "id": 5,
                    "key": "BETRADAR"
                }
            ],
            "globalLeague": {
                "id": 532280435,
                "name": "ITF W60 Rio de Janeiro Qualifiers"
            },
            "globalTeam1": {
                "id": 533246634,
                "name": "Christina Rosca"
            },
            "globalTeam2": {
                "id": 2301477466,
                "name": "Valentina Ponce Serrano"
            },
            "gamesCount": 4,
            "prematchGamesCount": 0,
            "liveGamesCount": 4,
            "inactiveGamesCount": 0
        },
        // ...
    }
]
```

### Отмена подписки на список глобальных игр

Для отмены подписки на список глобальных игр достаточно выполнить запрос `globalGameList/unsubscribe`:

```js
> [
    10,
    "globalGameList.unsubscribe",
]
```

В ответ вы получите сообщение `globalGameList/unsubscribed`, а перед этим будет получено сообщение `globalGameList/deleted`, удаляющее список глобальных игр:

```js
< [
    null,
    null,
    "globalGameList/deleted",
    "\u0000",
]
```

```js
< [
    10,
    null,
    "globalGameList/unsubscribed",
]
```

----

## Глобальная игра

### Создание подписки на глобальную игру

Например, для подписки на глобальную игру #1151635659 достаточно выполнить запрос `globalGame:1151635659/subscribe`:

```js
> [
    11,
    "globalGame:1151635659/subscribe",
]
```

В случае успешной подписки в ответ на запрос вы получите сообщение `globalGame:1151635659/subscribed`, а после получите сообщение `globalGame:1151635659/created` со слепком данных глобальной игры:

```js
< [
    11,
    null,
    "globalGame:1151635659/subscribed",
]
```

```js
[
    null,
    "globalGame:1151635659/created",
    {
        "id": 1151635659,
        // ...
    }
]
```

При изменении данных глобальной игры вы получите сообщение `globalGame:1151635659/updated` с изменениями:

```js
< [
    null,
    null,
    "globalGame:1151635659/updated",
    {
        "periodKey": "set:3",
        // ...
    }
]
```

> В одном сообщении `globalGame:1151635659/updated` могут приходить множественные изменения данных глобальной игры.

При удалении глобальной игры вы получите сообщение об удалении, а также сообщение о принудительной отписке:

```js
< [
    null,
    null,
    "globalGame:1151635659/deleted",
    "\u0000",
]
```

```js
< [
    null,
    null,
    "globalGame:1151635659/unsubscribed",
]
```

### Отмена подписки на глобальную игру

Для отмены подписки на глобальную игру достаточно выполнить запрос `globalGameList/unsubscribe`:

```js
> [
    12,
    "globalGame:1151635659/unsubscribe",
]
```

В ответ вы получите сообщение `globalGame:1151635659/unsubscribed`, а перед этим будет получено сообщение `globalGame:1151635659/deleted`, удаляющее глобальную игру:

```js
< [
    null,
    null,
    "globalGame:1151635659/deleted",
    "\u0000",
]
```

```js
< [
    12,
    null,
    "globalGame:1151635659/unsubscribed",
]
```

----


## Пример работы с API

Вы можете ознакомиться с [примером небольшого приложения](../../tree/main/example-app), построенного на платформе Node.js, чтобы посмореть, как работает система на практике.
